## 目标

* 将城市、星座时间范围、性别、音乐标签等系统常量集中管理，支持云数据库统一配置与本地 JSON 回退，确保前后端一致与可维护。

## 数据结构与存储

* 云数据库集合：`sys_config`

  * 字段：`type`(string)、`data`(any JSON)、`version`(string)、`updatedAt`(Date)

  * 文档示例：

    * `type: 'cities'` → `data: ["北京","上海",...]`

    * `type: 'genders'` → `data: [{value:0,label:"保密"},{value:1,label:"男"},{value:2,label:"女"}]`

    * `type: 'zodiac_ranges'` → `data: [{name:"摩羯座", start:{m:12,d:22}, end:{m:1,d:19}}, ...]`

    * `type: 'music_tags'` → `data: ["摇滚","朋克","金属",...]`

* 可选本地回退：`miniprogram/config/system.json`（仅作为云缺失时的默认，后续实现时再创建）

## 云函数接口

* 新增 `config` 云函数：

  * `getConfigs(types: string[])` → 返回 `{ cities, genders, zodiac_ranges, music_tags }` 的聚合对象（仅查询、无写入）

  * `getConfigByType(type: string)` → 返回单项配置

  * 读取失败或不存在时返回错误码与友好信息

## 前端接入

* 启动/页面进入时：

  * 调用 `getConfigs(["cities","genders","zodiac_ranges","music_tags"])`

  * 本地缓存 `sysConfig`（含 `expireTime`，如 24h），优先用缓存，失效则重新拉取

* 使用方式：

  * 个人信息页与编辑页：

    * 城市选择：用 `cities` 生成 Picker 或选择器

    * 性别选择：用 `genders` 渲染选项

    * 音乐标签：用 `music_tags` 渲染 Tag 列表

    * 星座计算：用 `zodiac_ranges` 替换硬编码的星座范围，封装 `calcZodiacByConfig(birthday, ranges)`

* 迁移：

  * 移除 `profile.ts` 中硬编码的 `genres/cities` 列表，改为从 `sysConfig` 读取

  * `calcZodiac` 在云端改为读取 `zodiac_ranges`，无配置时回退旧逻辑

## 缓存与回退策略

* 本地缓存键：`sysConfig`，结构 `{ data: {...}, expireTime: number }`

* 拉取失败或为空：回退到本地 JSON 默认值（如存在），并提示“配置暂用默认值”

## 权限与维护

* 读取开放（无需登录）；更新仅限管理员（后续可加维护页面）

* 版本字段 `version` 便于灰度与比对（可选）

## 测试用例

1. 云端存在配置：前端成功拉取并缓存，UI 按配置渲染
2. 云端缺失：前端回退本地 JSON，UI正常；控制台提示默认值
3. 缓存过期：自动重新拉取并更新缓存
4. 星座计算：按 `zodiac_ranges` 校验每个边界日期正确性

## 变更范围

* 新增 `cloudfunctions/config` 云函数

* 前端在 `profile.ts/profile-edit.ts` 接入 `sysConfig` 并替换硬编码项

* 后端 `user` 云函数的 `calcZodiac` 改为优先读配置

请确认以上方案，确认后我将创建 `sys_config` 集合与云函数接口，并在前端接入与迁移现有硬编码。
