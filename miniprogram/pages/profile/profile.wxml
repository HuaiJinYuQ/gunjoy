<!--miniprogram/pages/profile/profile.wxml-->
<view class="container">

  <!-- 顶部信息卡片 -->
  <view class="top-section" style="padding-top: {{statusBarHeight}}px">

    <view class="profile-card" bindtap="goToProfileEdit" style="min-height: {{navContentHeight}}px">
      <image class="avatar avatar--md" mode="aspectFill" src="{{(dbUser && (dbUser.avatarUrl || dbUser.avatar)) || (userInfo && userInfo.avatarUrl) || '../../images/head.png'}}"></image>
      <view class="profile-meta">
        <text class="nickname">{{(dbUser && dbUser.nickname) || (userInfo && userInfo.nickName) || '未登录'}}</text>
        <view class="meta-row" wx:if="{{isLoggedIn}}">
          <text class="meta-item">{{computedAge ? computedAge + '岁' : '年龄未设置'}}</text>
          <text class="meta-sep">·</text>
          <view class="tags-fixed" bindlongpress="onTagsContainerLongPress">
            <view wx:for="{{genres}}" wx:key="*this" class="tag-chip" bindlongpress="onTagLongPress" data-tag="{{item}}">
              <text class="chip-text">{{item}}</text>
            </view>
            <text wx:if="{{!genres.length}}" class="meta-item">标签未设置</text>
          </view>
          <text wx:if="{{genres.length}}" class="meta-action" bindtap="toggleTagsExpanded">{{showAllTags ? '收起' : '展开'}}</text>
          <text class="meta-sep">·</text>
          <text class="meta-item">{{(dbUser && dbUser.province) || ''}} {{(dbUser && dbUser.city) || ''}}</text>
        </view>
        <view wx:if="{{showAllTags}}" class="tags-expanded">
          <view wx:for="{{genres}}" wx:key="*this" class="tag-chip">
            <text class="chip-text">{{item}}</text>
          </view>
        </view>
      </view>
      <text class="edit-arrow">›</text>
    </view>
  </view>



  


  <!-- 底部登录弹窗 -->
  <view class="login-bottom-sheet" wx:if="{{!isLoggedIn}}">
    <text class="sheet-title">登录后可同步你的收藏与发帖</text>
    <button class="sheet-btn" bindtap="onLoginClick">微信身份登录</button>
  </view>
</view>
