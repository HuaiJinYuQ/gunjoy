<!--miniprogram/pages/profile/profile.wxml-->
<view class="container">
  <!-- 用户信息区域 -->
  <view class="user-section">
    <view class="user-info" wx:if="{{isLoggedIn}}">
      <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
      <text class="nickname">{{userInfo.nickName}}</text>
      <view class="user-stats">
        <view class="stat-item">
          <text class="stat-number">{{favoriteCount}}</text>
          <text class="stat-label">收藏</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{noteCount}}</text>
          <text class="stat-label">笔记</text>
        </view>
      </view>
    </view>
    
    <view class="login-section" wx:else>
      <view class="login-prompt">
        <text class="login-title">登录滚聚</text>
        <text class="login-desc">发现更多摇滚现场</text>
      </view>
      <button class="login-btn" bindtap="getUserProfile" wx:if="{{canIUseGetUserProfile}}">
        <text>微信授权登录</text>
      </button>
      <button class="login-btn" open-type="getUserInfo" bindgetuserinfo="getUserInfo" wx:else>
        <text>微信授权登录</text>
      </button>
    </view>
  </view>

  <!-- 音乐偏好设置 -->
  <view class="preferences-section" wx:if="{{isLoggedIn}}">
    <view class="section-title">
      <text>音乐偏好</text>
    </view>
    
    <view class="preference-group">
      <view class="preference-label">
        <text>喜欢的风格</text>
      </view>
      <view class="tag-container">
        <view 
          wx:for="{{genres}}" 
          wx:key="*this" 
          class="tag {{preferences.genres.indexOf(item) > -1 ? 'active' : ''}}"
          bindtap="onGenreChange"
          data-index="{{index}}"
        >
          <text>{{item}}</text>
        </view>
      </view>
    </view>

    <view class="preference-group">
      <view class="preference-label">
        <text>关注城市</text>
      </view>
      <view class="tag-container">
        <view 
          wx:for="{{cities}}" 
          wx:key="*this" 
          class="tag {{preferences.cities.indexOf(item) > -1 ? 'active' : ''}}"
          bindtap="onCityChange"
          data-index="{{index}}"
        >
          <text>{{item}}</text>
        </view>
      </view>
    </view>

    <view class="preference-group">
      <view class="preference-label">
        <text>价格区间</text>
      </view>
      <view class="tag-container">
        <view 
          wx:for="{{priceRanges}}" 
          wx:for-item="range" 
          wx:key="index" 
          class="tag {{preferences.priceRange[0] === range.value[0] && preferences.priceRange[1] === range.value[1] ? 'active' : ''}}"
          bindtap="onPriceRangeChange"
          data-index="{{index}}"
        >
          <text>{{range.label}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-item" bindtap="onMyFavorites" wx:if="{{isLoggedIn}}">
      <text class="menu-text">我的收藏</text>
      <image src="/miniprogram/icons/s-arrow-g.svg" class="arrow-icon"></image>
    </view>
    
    <view class="menu-item" bindtap="onMyNotes" wx:if="{{isLoggedIn}}">
      <text class="menu-text">我的笔记</text>
      <image src="/miniprogram/icons/s-arrow-g.svg" class="arrow-icon"></image>
    </view>
    
    <view class="menu-item" bindtap="onAbout">
      <text class="menu-text">关于滚聚</text>
      <image src="/miniprogram/icons/s-arrow-g.svg" class="arrow-icon"></image>
    </view>
    
    <view class="menu-item" bindtap="onLogout" wx:if="{{isLoggedIn}}">
      <text class="menu-text logout-text">退出登录</text>
      <image src="/miniprogram/icons/s-arrow-g.svg" class="arrow-icon"></image>
    </view>
  </view>
</view>